graph LR
%% Edge Devices
subgraph EdgeDevices["🌐 Edge Devices"]
Mobile["📱<br/>Mobile App"]
IoT["🔧<br/>IoT Sensors"]
Gaming["🎮<br/>Gaming Client"]
end

    %% MEC Site (Main Processing)
    subgraph MECSite["🏢 MEC Site"]
        subgraph MECOrch["MEC Orchestrator"]
            Agent["🤖<br/>MEC Agent"]
            Tools["🛠️<br/>Local Tools<br/>• metrics_monitor()<br/>• container_ops()<br/>• cache_manager()"]
        end

        subgraph MECCompute["💻 MEC Compute"]
            Container1["📦 Container A"]
            Container2["📦 Container B"]
            GPU["🎯 GPU Inference"]
        end

        LocalStorage["💾<br/>Local Cache"]
    end

    %% Swarm Coordination
    subgraph SwarmLayer["🤝 Swarm Coordination"]
        SwarmCoord["⚡<br/>Swarm Coordinator"]
        Consensus["🧠<br/>Consensus Engine<br/>(Raft Protocol)"]
        LoadBalancer["⚖️<br/>Load Balancer"]
    end

    %% Cloud Fallback
    subgraph CloudLayer["☁️ Cloud Fallback"]
        CloudCompute["🌩️<br/>Cloud Compute"]
        CloudStorage["💽<br/>Cloud Storage"]
    end

    %% Monitoring & Observability
    subgraph Monitoring["📊 Monitoring"]
        Metrics["📈<br/>Metrics Monitor"]
        Alerts["🚨<br/>Alert System"]
    end

    %% Primary Request Flow
    Mobile -->|"1. User Request"| Agent
    IoT -->|"1. Sensor Data"| Agent
    Gaming -->|"1. Game State"| Agent

    %% MEC Internal Processing
    Agent -->|"2. Process Request"| Container1
    Agent -->|"2. Route to GPU"| GPU
    Agent -->|"3. Cache Check"| LocalStorage

    %% Swarm Coordination Flow
    Agent -->|"4. Swarm Decision"| SwarmCoord
    SwarmCoord -->|"5. Consensus"| Consensus
    SwarmCoord -->|"6. Load Balance"| LoadBalancer

    %% Monitoring Flow
    Agent -.->|"Metrics"| Metrics
    SwarmCoord -.->|"Health Check"| Metrics
    Metrics -.->|"Threshold Breach"| Alerts

    %% Fallback Flow
    SwarmCoord -.->|"7. Failover<br/>(if overloaded)"| CloudCompute
    CloudCompute --> CloudStorage

    %% Response Flow
    Container1 -->|"8. Response"| Agent
    GPU -->|"8. Inference Result"| Agent
    Agent -->|"9. Final Response"| Mobile

    %% Styling
    classDef edgeStyle fill:#e8f5e8,stroke:#4caf50,stroke-width:2px
    classDef mecStyle fill:#e3f2fd,stroke:#2196f3,stroke-width:2px
    classDef swarmStyle fill:#f3e5f5,stroke:#9c27b0,stroke-width:2px
    classDef cloudStyle fill:#fff3e0,stroke:#ff9800,stroke-width:2px
    classDef monitorStyle fill:#fce4ec,stroke:#e91e63,stroke-width:2px

    class EdgeDevices,Mobile,IoT,Gaming edgeStyle
    class MECSite,MECOrch,MECCompute,Agent,Tools,Container1,Container2,GPU,LocalStorage mecStyle
    class SwarmLayer,SwarmCoord,Consensus,LoadBalancer swarmStyle
    class CloudLayer,CloudCompute,CloudStorage cloudStyle
    class Monitoring,Metrics,Alerts monitorStyle
